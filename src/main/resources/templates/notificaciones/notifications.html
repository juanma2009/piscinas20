<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="admin/admin_layout">

<head>
  <meta charset="UTF-8">
  <title>Notificaciones</title>
</head>

<body>
<div layout:fragment="content">
  <div class="container-fluid px-2 px-md-3">
    <section class="content-header">
      <div class="card">
        <div class="card-header">
          <i class="fas fa-bell mr-2"></i> Notificaciones del Sistema
        </div>

        <div class="toolbar">
          <a th:href="@{/pedidos/listarPedidos}" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-list mr-1"></i> Pedidos
          </a>
          <a th:href="@{/listar}" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-users mr-1"></i> Clientes
          </a>
        </div>

        <div class="card-body">
          <!-- Pestañas para las diferentes categorías -->
          <ul class="nav nav-tabs mb-4" id="notificationTabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="orders-tab" data-toggle="tab" href="#orders" role="tab" aria-controls="orders" aria-selected="true">
                <i class="fas fa-shopping-cart mr-1"></i> Pedidos
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="sms-tab" data-toggle="tab" href="#sms" role="tab" aria-controls="sms" aria-selected="false">
                <i class="fas fa-sms mr-1"></i> SMS Enviados
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="stock-tab" data-toggle="tab" href="#stock" role="tab" aria-controls="stock" aria-selected="false">
                <i class="fas fa-box mr-1"></i> Stock
              </a>
            </li>
          </ul>

          <div class="tab-content" id="notificationTabsContent">
            <!-- Tab de Pedidos -->
            <div class="tab-pane fade show active" id="orders" role="tabpanel" aria-labelledby="orders-tab">
              <div class="table-responsive">
                <table class="table table-striped table-bordered datatable w-100" id="orders-table" data-dt="auto">
                  <thead>
                  <tr>
                    <th>Mensaje</th>
                    <th>Estado</th>
                    <th class="text-center">Acciones</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr th:each="order : ${orders}">
                    <td>
                      <span class="badge badge-danger mr-2" th:if="${order.estado == 'Preparación'}">&nbsp;</span>
                      <span th:classappend="${order.estado == 'Preparación' ? 'text-danger font-weight-bold' : ''}"
                            th:text="${order.mensaje}"></span>
                    </td>
                    <td>
                        <span class="badge" th:classappend="${order.estado == 'Preparación' ? 'badge-warning' : 'badge-info'}" th:text="${order.estado}"></span>
                    </td>
                    <td class="text-center">
                      <button class="btn btn-primary btn-sm" th:if="${order.estado != 'Preparación'}"
                              th:onclick="'window.location.href=\'/cambiarEstado?pedidoId=' + ${order.id} + '\''">
                        <i class="fas fa-sync-alt mr-1"></i> Cambiar a Preparación
                      </button>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Tab de SMS Enviados -->
            <div class="tab-pane fade" id="sms" role="tabpanel" aria-labelledby="sms-tab">
              <div class="table-responsive">
                <table class="table table-striped table-bordered datatable w-100" id="sms-table" data-dt="auto">
                  <thead>
                  <tr>
                    <th>Mensaje</th>
                    <th>Estado</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr th:each="sms : ${smsNotifications}">
                    <td th:text="${sms.mensaje}"></td>
                    <td><span class="badge badge-success">Enviado Correctamente</span></td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Tab de Stock -->
            <div class="tab-pane fade" id="stock" role="tabpanel" aria-labelledby="stock-tab">
              <div class="table-responsive">
                <table class="table table-striped table-bordered datatable w-100" id="stock-table" data-dt="auto">
                  <thead>
                  <tr>
                    <th>Producto</th>
                    <th>Estado</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr th:each="stock : ${stockNotifications}">
                    <td th:text="${stock.producto}"></td>
                    <td><span class="badge badge-danger" th:text="${stock.estado}"></span></td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<div layout:fragment="script">
  <script>
    $(document).ready(function () {
      // Fix for DataTable responsiveness on tab change
      $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
          $.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();
      });
    });
  </script>
</div>
</body>
</html>
